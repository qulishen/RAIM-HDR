<p align="center">
  <img src="logo.png" alt="RAIM-HDR Logo" width="200"/>
</p>

<h1 align="center">ğŸŒŸ RAIM-HDR: åŠ¨æ€åœºæ™¯ä¸‹çš„å¤šæ›å…‰å›¾åƒèåˆ </h1>

<p align="center">
  <a href="README.md"><img src="https://img.shields.io/badge/Language-English-blue" alt="English"></a>
  <a href="README_cn.md"><img src="https://img.shields.io/badge/è¯­è¨€-ä¸­æ–‡-red" alt="ä¸­æ–‡"></a>
  <a href="https://www.codabench.org/competitions/12728/"><img src="https://img.shields.io/badge/ğŸ†_æ¯”èµ›-CodaBench-orange" alt="Competition"></a>
</p>

---

æœ¬ä»“åº“æä¾›äº† **ç¬¬ä¸‰å±Š Restore Any Image Model (RAIM) æŒ‘æˆ˜èµ›ï¼šåŠ¨æ€åœºæ™¯ä¸‹çš„å¤šæ›å…‰å›¾åƒèåˆ (èµ›é“2)** çš„åŸºçº¿ä»£ç  ğŸ¯

ğŸ”— **æ¯”èµ›é“¾æ¥**: [https://www.codabench.org/competitions/12728/](https://www.codabench.org/competitions/12728/)

## ğŸ“– æ¦‚è¿°

æœ¬èµ›é“çš„ç›®æ ‡æ˜¯å°†å¤šå¼ ä¸åŒæ›å…‰çº§åˆ«çš„ LDRï¼ˆä½åŠ¨æ€èŒƒå›´ï¼‰å›¾åƒèåˆæˆä¸€å¼  HDRï¼ˆé«˜åŠ¨æ€èŒƒå›´ï¼‰å›¾åƒï¼ŒåŒæ—¶å¤„ç†åŠ¨æ€åœºæ™¯ä¸­å¯èƒ½å‡ºç°çš„è¿åŠ¨ä¼ªå½±ã€‚âœ¨

æˆ‘ä»¬çš„åŸºçº¿æ¨¡å‹åŸºäº **Uformer** æ¶æ„ï¼Œé’ˆå¯¹å¤šæ›å…‰å›¾åƒèåˆä»»åŠ¡è¿›è¡Œäº†é€‚é…ã€‚ğŸš€

## ğŸ“¦ æ•°æ®é›†

### ğŸ“¥ ä¸‹è½½

ä»ä»¥ä¸‹é“¾æ¥ä¸‹è½½æ•°æ®é›†ï¼š[www.example.com](https://www.example.com)

### ğŸ—‚ï¸ ç›®å½•ç»“æ„

æ•°æ®é›†åº”æŒ‰ä»¥ä¸‹æ–¹å¼ç»„ç»‡ï¼š

```
datasets/
â”œâ”€â”€ train/
â”‚   â”œâ”€â”€ 001/
â”‚   â”‚   â”œâ”€â”€ 0.jpg      # ğŸŒ‘ æœ€æš—æ›å…‰
â”‚   â”‚   â”œâ”€â”€ 1.jpg
â”‚   â”‚   â”œâ”€â”€ 2.jpg
â”‚   â”‚   â”œâ”€â”€ 3.jpg      # âš–ï¸ ä¸­ç­‰æ›å…‰
â”‚   â”‚   â”œâ”€â”€ 4.jpg
â”‚   â”‚   â”œâ”€â”€ 5.jpg
â”‚   â”‚   â””â”€â”€ 6.jpg      # â˜€ï¸ æœ€äº®æ›å…‰
â”‚   â”‚   â””â”€â”€ HDR.jpg    # ğŸ¨ HDR å›¾åƒ
â”‚   â”œâ”€â”€ 002/
â”‚   â”‚   â”œâ”€â”€ 0.jpg
â”‚   â”‚   â”œâ”€â”€ ...
â”‚   â”‚   â””â”€â”€ 6.jpg
â”‚   â”‚   â””â”€â”€ HDR.jpg    # ğŸ¨ HDR å›¾åƒ
â”‚   â””â”€â”€ ...
â””â”€â”€ test/
    â”œâ”€â”€ 001/
    â”‚   â”œâ”€â”€ 1.jpg
    â”‚   â”œâ”€â”€ ...
    â”‚   â””â”€â”€ 5.jpg
    â””â”€â”€ ...
```

è®­ç»ƒé›†çš„æ¯ä¸ªåœºæ™¯æ–‡ä»¶å¤¹åŒ…å« 7 å¼ å›¾åƒï¼ˆ0.jpg åˆ° 6.jpgï¼‰ï¼ŒæŒ‰æ›å…‰çº§åˆ«ä»æš—åˆ°äº®æ’åºã€‚ğŸ“¸

## ğŸ› ï¸ å®‰è£…

### ğŸ“‹ ç¯å¢ƒè¦æ±‚

- ğŸ Python >= 3.8
- ğŸ”¥ PyTorch >= 1.12
- âš¡ CUDA >= 11.3

### ğŸ“¦ å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

è®­ç»ƒæ‰€éœ€çš„é¢å¤–ä¾èµ–ï¼š

```bash
pip install opencv-python-headless timm scipy einops accelerate lmdb ftfy tqdm Pillow tensorboard
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### ğŸ‹ï¸ è®­ç»ƒ

ä½¿ç”¨æä¾›çš„è„šæœ¬å¼€å§‹è®­ç»ƒï¼š

```bash
./train.sh
```

æˆ–è€…ä½¿ç”¨è‡ªå®šä¹‰è®¾ç½®æ‰‹åŠ¨è¿è¡Œï¼š

```bash
CUDA_VISIBLE_DEVICES=0,1 torchrun --nproc_per_node=2 --master_port=4392 \
    basicsr/train.py -opt options/Uformer.yml --launcher pytorch --auto_resume
```

**å…³é”®è®­ç»ƒå‚æ•°**ï¼ˆåœ¨ `options/Uformer.yml` ä¸­é…ç½®ï¼‰ï¼š

| å‚æ•°                 | å€¼     | æè¿°           |
| -------------------- | ------ | -------------- |
| `batch_size_per_gpu` | 8      | æ¯ä¸ª GPU çš„æ‰¹å¤§å° |
| `gt_size`            | 256    | è®­ç»ƒå›¾å—å¤§å°   |
| `total_iter`         | 300000 | æ€»è®­ç»ƒè¿­ä»£æ¬¡æ•° |
| `lr`                 | 2e-4   | å­¦ä¹ ç‡         |
| `ema_decay`          | 0.999  | EMA è¡°å‡ç‡     |

### ğŸ§ª æµ‹è¯• / æ¨ç†

åœ¨æµ‹è¯•å›¾åƒä¸Šè¿è¡Œæ¨ç†ï¼š

```bash
python test_crop.py \
    --input_dir /path/to/test/images \
    --output_dir /path/to/output \
    --weights /path/to/checkpoint.pth \
    --opt options/Uformer.yml \
    --crop_size 256 \
    --crop_shave 32 \
    --factor 16
```

**å‚æ•°è¯´æ˜ï¼š**

| å‚æ•°           | é»˜è®¤å€¼ | æè¿°                     |
| -------------- | ------ | ------------------------ |
| `--input_dir`  | -      | åŒ…å«åºåˆ—å­æ–‡ä»¶å¤¹çš„æ ¹ç›®å½• |
| `--output_dir` | -      | èåˆå HDR å›¾åƒçš„è¾“å‡ºç›®å½• |
| `--weights`    | -      | è®­ç»ƒå¥½çš„æ¨¡å‹æ£€æŸ¥ç‚¹è·¯å¾„   |
| `--opt`        | -      | YAML é…ç½®æ–‡ä»¶è·¯å¾„        |
| `--crop_size`  | 256    | åˆ†å—æ¨ç†çš„å—å¤§å°         |
| `--crop_shave` | 32     | åˆ†å—æ··åˆçš„é‡å å¤§å°       |
| `--factor`     | 16     | ç½‘ç»œæ­¥é•¿çš„å¡«å……å› å­       |

### ğŸ“Š è¯„ä¼°

å¯¹æ¯”çœŸå®å€¼è¯„ä¼°é¢„æµ‹ç»“æœï¼š

```bash
python eval.py \
    --pred_root /path/to/predictions \
    --gt_root /path/to/ground_truth \
    --device auto
```

**å‚æ•°è¯´æ˜ï¼š**

| å‚æ•°          | é»˜è®¤å€¼ | æè¿°               |
| ------------- | ------ | ------------------ |
| `--pred_root` | -      | åŒ…å«é¢„æµ‹å›¾åƒçš„ç›®å½• |
| `--gt_root`   | -      | åŒ…å«çœŸå®å›¾åƒçš„ç›®å½• |
| `--device`    | auto   | è®¾å¤‡é€‰æ‹© (auto/cpu/cuda) |

**è¯„ä¼°æŒ‡æ ‡ï¼š** ğŸ“ˆ

- ğŸ“ **PSNR**: å³°å€¼ä¿¡å™ªæ¯”
- ğŸ” **SSIM**: ç»“æ„ç›¸ä¼¼æ€§æŒ‡æ•°
- ğŸ§  **LPIPS**: å­¦ä¹ æ„ŸçŸ¥å›¾åƒå—ç›¸ä¼¼åº¦
- ğŸ† **Score**: éµå¾ª NTIRE å…¬å¼çš„åŠ æƒç»„åˆå¾—åˆ†

## ğŸ“ é¡¹ç›®ç»“æ„

```
RAIM-HDR/
â”œâ”€â”€ basicsr/                 # ğŸ”§ æ ¸å¿ƒåº“
â”‚   â”œâ”€â”€ archs/              # ğŸ—ï¸ ç½‘ç»œæ¶æ„ (Uformer ç­‰)
â”‚   â”œâ”€â”€ data/               # ğŸ“Š æ•°æ®é›†åŠ è½½å™¨
â”‚   â”œâ”€â”€ losses/             # ğŸ“‰ æŸå¤±å‡½æ•°
â”‚   â”œâ”€â”€ metrics/            # ğŸ“ è¯„ä¼°æŒ‡æ ‡
â”‚   â”œâ”€â”€ models/             # ğŸ¤– è®­ç»ƒæ¨¡å‹
â”‚   â”œâ”€â”€ ops/                # âš™ï¸ è‡ªå®šä¹‰ CUDA ç®—å­
â”‚   â”œâ”€â”€ utils/              # ğŸ› ï¸ å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ train.py            # ğŸ‹ï¸ è®­ç»ƒè„šæœ¬
â”‚   â””â”€â”€ test.py             # ğŸ§ª æµ‹è¯•è„šæœ¬
â”œâ”€â”€ datasets/               # ğŸ“¦ æ•°æ®é›†æ–‡ä»¶å¤¹
â”œâ”€â”€ options/                # âš™ï¸ é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ Uformer.yml        # ğŸ“ Uformer è®­ç»ƒé…ç½®
â”œâ”€â”€ train.sh               # ğŸš€ è®­ç»ƒå¯åŠ¨è„šæœ¬
â”œâ”€â”€ test_crop.py           # ğŸ”¬ åˆ†å—æ¨ç†è„šæœ¬
â”œâ”€â”€ eval.py                # ğŸ“Š è¯„ä¼°è„šæœ¬
â”œâ”€â”€ requirements.txt       # ğŸ“‹ Python ä¾èµ–
â””â”€â”€ README.md
```

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦æœ¯ç ”ç©¶ä½¿ç”¨ã€‚ğŸ“

## ğŸ™ è‡´è°¢

- [BasicSR](https://github.com/XPixelGroup/BasicSR) - è®­ç»ƒæ¡†æ¶ ğŸ’ª
- [Uformer](https://github.com/ZhendongWang6/Uformer) - éª¨å¹²ç½‘ç»œæ¶æ„ ğŸŒŸ

---

<p align="center">
  <b>ç¥æ¯”èµ›é¡ºåˆ©ï¼ğŸ€ğŸ‰</b>
</p>
